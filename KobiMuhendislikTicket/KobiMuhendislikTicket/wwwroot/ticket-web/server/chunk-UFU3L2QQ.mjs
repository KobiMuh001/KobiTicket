import './polyfills.server.mjs';
import{a as A}from"./chunk-VYQK7HBG.mjs";import{a as V}from"./chunk-O7OTTCDM.mjs";import"./chunk-2ZDBELSD.mjs";import{k as L,n as I}from"./chunk-RBKH3TAP.mjs";import{Ma as b,Oa as h,Pa as T,Ra as v,Ta as k,V as P,Wa as w,Xa as E,Ya as r,Za as o,_a as u,ba as C,bb as M,ca as y,cb as _,cc as z,da as g,db as d,ea as x,fc as D,jb as c,kb as p,lb as m,sb as F,ub as N,ya as s,za as O}from"./chunk-Q22LFSCO.mjs";import"./chunk-VVCT4QZE.mjs";var B=(a,l)=>l.id,G=a=>["/staff/tickets",a];function $(a,l){if(a&1){let t=M();r(0,"div",4),c(1),r(2,"button",19),_("click",function(){C(t);let n=d();return y(n.error=null)}),c(3,"\xD7"),o()()}if(a&2){let t=d();s(),m(" ",t.error," ")}}function j(a,l){if(a&1&&(r(0,"div",5),c(1),o()),a&2){let t=d();s(),m(" ",t.successMessage," ")}}function H(a,l){if(a&1&&(r(0,"option",20),c(1),o()),a&2){let t,i=l.$implicit;h("value",((t=i.sortOrder)!==null&&t!==void 0?t:i.id)+""),s(),p(i.label)}}function Y(a,l){a&1&&(r(0,"div",18),c(1,"Y\xFCkleniyor..."),o())}function R(a,l){a&1&&(r(0,"div",21),g(),r(1,"svg",22),u(2,"path",23)(3,"polyline",24),o(),x(),r(4,"p"),c(5,"T\xFCm ticketlar atanm\u0131\u015F! \u{1F389}"),o()())}function K(a,l){if(a&1&&(r(0,"div",35),g(),r(1,"svg",36),u(2,"rect",45)(3,"path",46),o(),x(),r(4,"span"),c(5),o()()),a&2){let t=d().$implicit;s(5),p(t.assetName)}}function U(a,l){if(a&1){let t=M();r(0,"div",27)(1,"div",28)(2,"span",29),c(3),o(),r(4,"span",30),c(5),o()(),r(6,"h3",31)(7,"span",32),c(8),o(),c(9),o(),r(10,"p",33),c(11),o(),r(12,"div",34)(13,"div",35),g(),r(14,"svg",36),u(15,"path",37)(16,"circle",38),o(),x(),r(17,"span"),c(18),o()(),b(19,K,6,1,"div",35),o(),r(20,"div",39)(21,"span",40),c(22),o(),r(23,"div",41)(24,"a",42),c(25," Detay "),o(),r(26,"button",43),_("click",function(){let n=C(t).$implicit,e=d(2);return y(e.claimTicket(n.id))}),g(),r(27,"svg",13),u(28,"path",44),o(),c(29," \xDCstlen "),o()()()()}if(a&2){let t=l.$implicit,i=d(2);v("priority-border-"+i.getPriorityClass(t.priority)),s(2),v(i.getPriorityClass(t.priority)),T("background-color",i.getPriorityColor(t.priority))("color",i.getPriorityColor(t.priority)?"#fff":null),s(),m(" ",i.getPriorityText(t.priority)," "),s(2),p(i.getTimeAgo(t.createdDate)),s(3),p(t.ticketCode||"#"+t.id),s(),m(" ",t.title," "),s(2),p(t.description),s(7),p(t.companyName||"Bilinmiyor"),s(),k(19,t.assetName?19:-1),s(3),p(i.formatDate(t.createdDate)),s(2),h("routerLink",N(17,G,t.id))}}function q(a,l){if(a&1&&(r(0,"div",25),w(1,U,30,19,"div",26,B),o()),a&2){let t=d();s(),E(t.filteredTickets)}}var it=(()=>{class a{constructor(t,i){this.staffService=t,this.paramSvc=i,this.tickets=[],this.filteredTickets=[],this.isLoading=!0,this.error=null,this.successMessage=null,this.selectedStatus="all",this.selectedPriority="all",this.statusOptions=[],this.priorityOptions=[]}ngOnInit(){this.loadTickets(),this.loadLookups()}loadLookups(){this.paramSvc.getByGroup("TicketStatus").subscribe({next:t=>{let i=t?.data?.data||t?.data||t||[];this.statusOptions=(Array.isArray(i)?i:[]).map((n,e)=>({id:n.id,key:n.key,label:n.value,sortOrder:n.sortOrder??e+1,color:n.value2??n.color??null}))},error:()=>{this.statusOptions=[]}}),this.paramSvc.getByGroup("TicketPriority").subscribe({next:t=>{let i=t?.data?.data||t?.data||t||[];this.priorityOptions=(Array.isArray(i)?i:[]).map((n,e)=>({id:n.id,key:n.key,label:n.value,sortOrder:n.sortOrder??e+1,color:n.value2??n.color??null}))},error:()=>{this.priorityOptions=[]}})}getStatusColor(t){let i=Number(t);return this.statusOptions.find(e=>Number(e.sortOrder??e.id)===i||String(e.id)===String(t)||String(e.key)===String(t)||e.label===t)?.color??null}getPriorityColor(t){let i=Number(t);return this.priorityOptions.find(e=>Number(e.sortOrder??e.id)===i||String(e.id)===String(t)||String(e.key)===String(t)||e.label===t)?.color??null}loadTickets(){this.isLoading=!0,this.staffService.getUnassignedTickets().subscribe({next:t=>{t.success&&(this.tickets=t.data,this.applyFilters()),this.isLoading=!1},error:t=>{this.error="Ticketlar y\xFCklenirken hata olu\u015Ftu",this.isLoading=!1}})}applyFilters(){this.filteredTickets=this.tickets.filter(t=>{let i=this.selectedStatus==="all"||t.status.toString()===this.selectedStatus,n=this.selectedPriority==="all"||t.priority.toString()===this.selectedPriority;return i&&n})}onPriorityFilterChange(t){this.selectedPriority=t.target.value,this.applyFilters()}onStatusFilterChange(t){this.selectedStatus=t.target.value,this.applyFilters()}claimTicket(t){this.staffService.claimTicket(t).subscribe({next:i=>{i.success&&(this.successMessage="Ticket ba\u015Far\u0131yla al\u0131nd\u0131",this.loadTickets(),setTimeout(()=>this.successMessage=null,3e3))},error:i=>{this.error=i.error?.message||"Ticket al\u0131n\u0131rken hata olu\u015Ftu"}})}getPriorityText(t){let i=Number(t),n=this.priorityOptions.find(e=>Number(e.sortOrder??e.id)===i||String(e.id)===String(t)||String(e.key)===String(t)||e.label===t);if(n)return n.label||"Normal";switch(t){case 1:return"D\xFC\u015F\xFCk";case 2:return"Normal";case 3:return"Y\xFCksek";case 4:return"Kritik";default:return"Normal"}}getPriorityClass(t){let i=Number(t),n=this.priorityOptions.find(e=>Number(e.sortOrder??e.id)===i||String(e.id)===String(t)||String(e.key)===String(t)||e.label===t);if(n)switch(Number(n.sortOrder??n.id)){case 1:return"priority-low";case 2:return"priority-normal";case 3:return"priority-high";case 4:return"priority-critical";default:return"priority-normal"}switch(t){case 1:return"priority-low";case 2:return"priority-normal";case 3:return"priority-high";case 4:return"priority-critical";default:return"priority-normal"}}getStatusText(t){let i=Number(t),n=this.statusOptions.find(e=>Number(e.sortOrder??e.id)===i||String(e.id)===String(t)||String(e.key)===String(t)||e.label===t);if(n)return n.label||"Bilinmiyor";switch(t){case 1:return"A\xE7\u0131k";case 2:return"\u0130\u015Flemde";case 3:return"M\xFC\u015Fteri Bekliyor";case 4:return"\xC7\xF6z\xFCld\xFC";case 5:return"Kapal\u0131";default:return"Bilinmiyor"}}getStatusClass(t){let i=Number(t),n=this.statusOptions.find(e=>Number(e.sortOrder??e.id)===i||String(e.id)===String(t)||String(e.key)===String(t)||e.label===t);if(n)switch(Number(n.sortOrder??n.id)){case 1:return"status-open";case 2:return"status-processing";case 3:return"status-waiting";case 4:return"status-resolved";case 5:return"status-closed";default:return""}switch(t){case 1:return"status-open";case 2:return"status-processing";case 3:return"status-waiting";case 4:return"status-resolved";case 5:return"status-closed";default:return""}}formatDate(t){return new Date(t).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}getTimeAgo(t){let i=new Date(t),e=new Date().getTime()-i.getTime(),f=Math.floor(e/(1e3*60*60)),S=Math.floor(f/24);return S>0?`${S} g\xFCn \xF6nce`:f>0?`${f} saat \xF6nce`:"Az \xF6nce"}static{this.\u0275fac=function(i){return new(i||a)(O(A),O(V))}}static{this.\u0275cmp=P({type:a,selectors:[["app-open-tickets"]],standalone:!0,features:[F],decls:29,vars:6,consts:[[1,"open-tickets-page"],[1,"page-header"],[1,"header-left"],[1,"subtitle"],[1,"alert","alert-error"],[1,"alert","alert-success"],[1,"filters-bar"],[1,"filter-group"],[3,"change","value"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"results-count"],[1,"refresh-btn",3,"click"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["points","23 4 23 10 17 10"],["points","1 20 1 14 7 14"],["d","M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"],[1,"tickets-container"],[1,"loading"],[1,"close-btn",3,"click"],[3,"value"],[1,"empty-state"],["width","64","height","64","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","1.5"],["d","M22 11.08V12a10 10 0 1 1-5.93-9.14"],["points","22 4 12 14.01 9 11.01"],[1,"tickets-grid"],[1,"ticket-card",3,"class"],[1,"ticket-card"],[1,"ticket-header"],[1,"priority-badge"],[1,"time-ago"],[1,"ticket-title"],[1,"ticket-code"],[1,"ticket-description"],[1,"ticket-meta"],[1,"meta-item"],["width","14","height","14","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"],["cx","12","cy","7","r","4"],[1,"ticket-footer"],[1,"created-date"],[1,"footer-actions"],[1,"detail-btn",3,"routerLink"],[1,"claim-btn",3,"click"],["d","M12 5v14M5 12h14"],["x","2","y","7","width","20","height","14","rx","2","ry","2"],["d","M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"]],template:function(i,n){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),c(4,"A\xE7\u0131k Ticketlar"),o(),r(5,"p",3),c(6,"Atanmam\u0131\u015F ve bekleyen ticketlar"),o()()(),b(7,$,4,1,"div",4)(8,j,2,1,"div",5),r(9,"div",6)(10,"div",7)(11,"label"),c(12,"\xD6ncelik:"),o(),r(13,"select",8),_("change",function(f){return n.onPriorityFilterChange(f)}),r(14,"option",9),c(15,"T\xFCm\xFC"),o(),b(16,H,2,2,"option",10),o()(),r(17,"div",11),c(18),o(),r(19,"button",12),_("click",function(){return n.loadTickets()}),g(),r(20,"svg",13),u(21,"polyline",14)(22,"polyline",15)(23,"path",16),o(),c(24," Yenile "),o()(),x(),r(25,"div",17),b(26,Y,2,0,"div",18)(27,R,6,0)(28,q,3,0),o()()),i&2&&(s(7),k(7,n.error?7:-1),s(),k(8,n.successMessage?8:-1),s(5),h("value",n.selectedPriority),s(3),h("ngForOf",n.priorityOptions),s(2),m(" ",n.filteredTickets.length," a\xE7\u0131k ticket "),s(8),k(26,n.isLoading?26:n.filteredTickets.length===0?27:28))},dependencies:[D,z,I,L],styles:[".open-tickets-page[_ngcontent-%COMP%]{padding:0}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:28px;font-weight:600;color:#1e293b;margin:0 0 8px}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#64748b;font-size:15px;margin:0}.alert[_ngcontent-%COMP%]{padding:12px 16px;border-radius:8px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between}.alert.alert-error[_ngcontent-%COMP%]{background:#fef2f2;color:#dc2626;border:1px solid #fecaca}.alert.alert-success[_ngcontent-%COMP%]{background:#f0fdf4;color:#16a34a;border:1px solid #bbf7d0}.alert[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;cursor:pointer;color:inherit}.filters-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px;margin-bottom:20px;padding:16px 20px;background:#fff;border-radius:12px;box-shadow:0 1px 3px #0000001a}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;color:#64748b;font-weight:500}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;color:#1e293b;background:#fff;cursor:pointer}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#059669}.results-count[_ngcontent-%COMP%]{margin-left:auto;font-size:14px;color:#64748b}.refresh-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:8px 16px;background:#f1f5f9;border:none;border-radius:8px;font-size:14px;color:#475569;cursor:pointer;transition:all .2s}.refresh-btn[_ngcontent-%COMP%]:hover{background:#e2e8f0}.tickets-container[_ngcontent-%COMP%]{min-height:400px}.loading[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{padding:80px 20px;text-align:center;color:#64748b;background:#fff;border-radius:12px;box-shadow:0 1px 3px #0000001a}.loading[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin-bottom:16px;opacity:.5}.loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:16px}.tickets-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px}.ticket-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:20px;box-shadow:0 1px 3px #0000001a;border-left:4px solid #e2e8f0;transition:all .2s}.ticket-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #0000001a;transform:translateY(-2px)}.ticket-card.priority-border-priority-critical[_ngcontent-%COMP%]{border-left-color:#ef4444}.ticket-card.priority-border-priority-high[_ngcontent-%COMP%]{border-left-color:#f59e0b}.ticket-card.priority-border-priority-normal[_ngcontent-%COMP%]{border-left-color:#3b82f6}.ticket-card.priority-border-priority-low[_ngcontent-%COMP%]{border-left-color:#94a3b8}.ticket-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}.priority-badge[_ngcontent-%COMP%]{font-size:11px;font-weight:600;padding:4px 10px;border-radius:6px}.priority-low[_ngcontent-%COMP%]{background:#f1f5f9;color:#64748b}.priority-normal[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.priority-high[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.priority-critical[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.time-ago[_ngcontent-%COMP%]{font-size:12px;color:#94a3b8}.ticket-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#1e293b;margin:0 0 8px;line-height:1.4;display:flex;align-items:center;gap:8px}.ticket-title[_ngcontent-%COMP%]   .ticket-code[_ngcontent-%COMP%]{display:inline-block;background:transparent;color:#0ea5e9;padding:0;border-radius:0;font-size:11px;font-weight:600;white-space:nowrap;flex-shrink:0}.ticket-description[_ngcontent-%COMP%]{font-size:14px;color:#64748b;margin:0 0 16px;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.ticket-meta[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid #f1f5f9}.meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:13px;color:#64748b}.meta-item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:.7}.ticket-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.footer-actions[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.created-date[_ngcontent-%COMP%]{font-size:12px;color:#94a3b8}.detail-btn[_ngcontent-%COMP%]{padding:8px 14px;background:#f1f5f9;color:#475569;border:1px solid #e2e8f0;border-radius:8px;font-size:13px;font-weight:500;text-decoration:none;cursor:pointer;transition:all .2s}.detail-btn[_ngcontent-%COMP%]:hover{background:#e2e8f0;color:#1e293b}.claim-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:8px 16px;background:#059669;color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.claim-btn[_ngcontent-%COMP%]:hover{background:#047857}@media (max-width: 768px){.tickets-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.filters-bar[_ngcontent-%COMP%]{flex-wrap:wrap}.results-count[_ngcontent-%COMP%]{width:100%;margin-left:0;margin-top:10px}}"]})}}return a})();export{it as OpenTicketsComponent};
