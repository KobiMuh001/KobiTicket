import './polyfills.server.mjs';
import{c as y}from"./chunk-O5JGRRVI.mjs";import{a as i}from"./chunk-ZF3RBZZJ.mjs";import{e as k,f as T,h as I,j as a,m as x}from"./chunk-JGHH2ILE.mjs";import{Ab as f,Ac as A,B as u,X as n,Zb as C,aa as c,fb as h,l as s,rc as g,va as l,yc as v,zc as S}from"./chunk-5C2672OW.mjs";var b=(()=>{class t{constructor(){this.title="ticket-web"}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=c({type:t,selectors:[["app-root"]],standalone:!0,features:[f],decls:1,vars:0,template:function(o,p){o&1&&h(0,"router-outlet")},dependencies:[I]})}}return t})();var P=(t,r)=>{let e=n(i),o=n(a);return e.isAuthenticated()&&e.isAdmin()?!0:(e.isAuthenticated()?o.navigate(["/unauthorized"]):o.navigate(["/login"],{queryParams:{returnUrl:r.url}}),!1)},w=(t,r)=>{let e=n(i),o=n(a);return e.isAuthenticated()&&e.isStaff()?!0:(e.isAuthenticated()?e.isAdmin()?o.navigate(["/admin"]):o.navigate(["/customer"]):o.navigate(["/login"],{queryParams:{returnUrl:r.url}}),!1)},d=(t,r)=>{let e=n(i),o=n(a);return e.isAuthenticated()?(e.isAdmin()?o.navigate(["/admin"]):e.isStaff()?o.navigate(["/staff"]):o.navigate(["/customer"]),!1):!0},D=(t,r)=>{let e=n(i),o=n(a);return e.isAuthenticated()&&e.isCustomer()?!0:(e.isAuthenticated()?e.isAdmin()?o.navigate(["/admin"]):e.isStaff()&&o.navigate(["/staff"]):o.navigate(["/login"],{queryParams:{returnUrl:r.url}}),!1)};var G=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",loadComponent:()=>import("./chunk-XSUPKFJS.mjs").then(t=>t.LoginComponent),canActivate:[d]},{path:"staff-login",loadComponent:()=>import("./chunk-DYRV4F6W.mjs").then(t=>t.StaffLoginComponent),canActivate:[d]},{path:"unauthorized",loadComponent:()=>import("./chunk-Z2SK3HXK.mjs").then(t=>t.UnauthorizedComponent)},{path:"admin",loadComponent:()=>import("./chunk-5J2DK4X3.mjs").then(t=>t.AdminLayoutComponent),canActivate:[P],children:[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",loadComponent:()=>import("./chunk-YE6CFTKJ.mjs").then(t=>t.AdminDashboardComponent)},{path:"tickets",loadComponent:()=>import("./chunk-FGYKPR5V.mjs").then(t=>t.TicketsComponent)},{path:"tickets/:id",loadComponent:()=>import("./chunk-QVKD5IX2.mjs").then(t=>t.TicketViewComponent)},{path:"tickets/:id/edit",loadComponent:()=>import("./chunk-RDK2PXUT.mjs").then(t=>t.TicketEditComponent)},{path:"tenants",loadComponent:()=>import("./chunk-AMYGCPAC.mjs").then(t=>t.TenantsComponent)},{path:"tenants/:id/products",loadComponent:()=>import("./chunk-BE4XEXBQ.mjs").then(t=>t.TenantProductsComponent)},{path:"tenants/:id",loadComponent:()=>import("./chunk-RHA4T7EQ.mjs").then(t=>t.TenantEditComponent)},{path:"assets",loadComponent:()=>import("./chunk-FCLC4S7J.mjs").then(t=>t.AssetsComponent)},{path:"products",loadComponent:()=>import("./chunk-FUX3YGKT.mjs").then(t=>t.ProductsComponent)},{path:"products/:id",loadComponent:()=>import("./chunk-J5RWXLXN.mjs").then(t=>t.ProductTenantsComponent)},{path:"assets/:id",loadComponent:()=>import("./chunk-ZUDMEQFI.mjs").then(t=>t.AssetEditComponent)},{path:"staff",loadComponent:()=>import("./chunk-DPL4S7JX.mjs").then(t=>t.StaffComponent)},{path:"staff/:id/tickets",loadComponent:()=>import("./chunk-FGYKPR5V.mjs").then(t=>t.TicketsComponent)},{path:"settings",loadComponent:()=>import("./chunk-SZXSNHY4.mjs").then(t=>t.SettingsComponent)},{path:"staff/:id",loadComponent:()=>import("./chunk-Q5CMW3QZ.mjs").then(t=>t.StaffEditComponent)}]},{path:"customer",loadComponent:()=>import("./chunk-OMNL447P.mjs").then(t=>t.CustomerLayoutComponent),canActivate:[D],children:[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",loadComponent:()=>import("./chunk-YESWFRT7.mjs").then(t=>t.CustomerDashboardComponent)},{path:"tickets",loadComponent:()=>import("./chunk-ND4NXRQA.mjs").then(t=>t.CustomerTicketsComponent)},{path:"tickets/new",loadComponent:()=>import("./chunk-H6PMTLOA.mjs").then(t=>t.CustomerTicketCreateComponent)},{path:"tickets/:id",loadComponent:()=>import("./chunk-A22VNH35.mjs").then(t=>t.CustomerTicketDetailComponent)},{path:"assets",loadComponent:()=>import("./chunk-MZ6VXFDU.mjs").then(t=>t.CustomerAssetsComponent)},{path:"profile",loadComponent:()=>import("./chunk-5IU2XLXG.mjs").then(t=>t.CustomerProfileComponent)}]},{path:"staff",loadComponent:()=>import("./chunk-7FNU3GZ5.mjs").then(t=>t.StaffLayoutComponent),canActivate:[w],children:[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",loadComponent:()=>import("./chunk-T5FV2DP3.mjs").then(t=>t.StaffDashboardComponent)},{path:"my-tickets",loadComponent:()=>import("./chunk-XME7F72S.mjs").then(t=>t.MyTicketsComponent)},{path:"open-tickets",loadComponent:()=>import("./chunk-F5G7K227.mjs").then(t=>t.OpenTicketsComponent)},{path:"tickets/:id",loadComponent:()=>import("./chunk-HUT55WD6.mjs").then(t=>t.TicketDetailComponent)},{path:"profile",loadComponent:()=>import("./chunk-J6BO2BXT.mjs").then(t=>t.StaffProfileComponent)}]},{path:"**",redirectTo:"login"}];function q(t){try{let e=JSON.parse(atob(t.split(".")[1])).exp*1e3;return Date.now()>e-3e4}catch{return!0}}function M(){localStorage.removeItem("token"),localStorage.removeItem("companyName"),localStorage.removeItem("rememberMe"),localStorage.removeItem("staffId"),localStorage.removeItem("fullName"),localStorage.removeItem("department"),sessionStorage.removeItem("token"),sessionStorage.removeItem("companyName"),sessionStorage.removeItem("staffId"),sessionStorage.removeItem("fullName"),sessionStorage.removeItem("department")}var E=(t,r)=>{let e=n(l),o=n(a);if(g(e)){let p=localStorage.getItem("token")||sessionStorage.getItem("token");if(p){if(!t.url.includes("/auth/")&&q(p))return M(),o.navigate(["/login"],{queryParams:{expired:"true"}}),s(()=>new Error("Token expired"));let L=t.clone({setHeaders:{Authorization:`Bearer ${p}`}});return r(L).pipe(u(m=>(m.status===401&&(M(),o.navigate(["/login"],{queryParams:{unauthorized:"true"}})),m.status===403&&o.navigate(["/unauthorized"]),s(()=>m))))}}return r(t)};var R={providers:[x(G),T(),v(A(),S([E]))]};var N={providers:[y()]},z=C(R,N);var U=()=>k(b,z),ct=U;export{ct as a};
