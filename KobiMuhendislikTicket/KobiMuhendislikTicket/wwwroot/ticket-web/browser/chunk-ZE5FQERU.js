import{a as ie}from"./chunk-7RKEGLV2.js";import{a as R}from"./chunk-2J5WZGWU.js";import{a as te}from"./chunk-2R6TGZNO.js";import{b as A,c as U,d as q,e as Y,f as H,g as J,i as K,j as Q,k as X,n as Z,r as $}from"./chunk-PRZMQGB5.js";import{a as ee}from"./chunk-3F3BRH62.js";import{c as D,e as G,f as B,i as W}from"./chunk-RCMVJVUR.js";import{La as x,Na as b,Sa as C,Va as E,Wa as F,Wb as L,Xa as i,Ya as n,Z as z,Za as g,ab as S,bb as k,cb as f,fa as u,ga as m,ha as _,ia as w,ib as a,jb as M,kb as I,nb as P,ob as O,pb as v,rb as j,ua as N,ya as s,za as h}from"./chunk-W3I5MFZP.js";var ne=(o,d)=>d.value,oe=(o,d)=>d.productId;function re(o,d){if(o&1&&(i(0,"div",6),_(),i(1,"svg",38),g(2,"path",39)(3,"polyline",40),n(),a(4),n()),o&2){let t=f();s(4),I(" ",t.successMessage," ")}}function ae(o,d){if(o&1&&(i(0,"div",7),_(),i(1,"svg",38),g(2,"circle",41)(3,"line",42)(4,"line",43),n(),a(5),n()),o&2){let t=f();s(5),I(" ",t.errorMessage," ")}}function le(o,d){if(o&1&&(i(0,"small",14),a(1),n()),o&2){let t=f();s(),M(t.titleError)}}function se(o,d){if(o&1){let t=S();i(0,"div",27),_(),i(1,"svg",4),g(2,"path",39)(3,"polyline",40),n(),w(),i(4,"span"),a(5),n(),i(6,"button",44),k("click",function(){u(t);let e=f();return m(e.clearFile())}),a(7,"\u2715"),n()()}if(o&2){let t=f();s(5),M(t.selectedFileName)}}function ce(o,d){if(o&1&&(i(0,"div",28),g(1,"img",45),n()),o&2){let t=f();s(),b("src",t.imagePreviewUrl,N)}}function de(o,d){if(o&1&&(i(0,"option",32),a(1),n()),o&2){let t=d.$implicit;b("value",t.value),s(),M(t.label)}}function pe(o,d){o&1&&(i(0,"select",34)(1,"option"),a(2,"Y\xFCkleniyor..."),n()())}function ue(o,d){if(o&1&&(i(0,"option",47),a(1),n()),o&2){let t=d.$implicit;b("ngValue",t.productId),s(),M(t.productName)}}function me(o,d){if(o&1){let t=S();i(0,"select",46),v("ngModelChange",function(e){u(t);let l=f();return O(l.ticket.productId,e)||(l.ticket.productId=e),m(e)}),i(1,"option",47),a(2,"\xDCr\xFCn Se\xE7in (Opsiyonel)"),n(),E(3,ue,2,2,"option",47,oe),n()}if(o&2){let t=f();P("ngModel",t.ticket.productId),s(),b("ngValue",null),s(2),F(t.products)}}function ge(o,d){o&1&&(g(0,"span",48),a(1," G\xF6nderiliyor... "))}function fe(o,d){o&1&&(_(),i(0,"svg",4),g(1,"line",49)(2,"polygon",50),n(),a(3," Talebi G\xF6nder "))}var ye=(()=>{class o{constructor(t,r,e,l,p,c){this.ticketService=t,this.productService=r,this.authService=e,this.systemParameterService=l,this.router=p,this.route=c,this.ticket={title:"",description:"",priority:2,productId:null},this.products=[],this.tenantId=null,this.isLoading=!1,this.isSubmitting=!1,this.errorMessage="",this.successMessage="",this.titleError="",this.selectedFile=null,this.selectedFileName="",this.imagePreviewUrl=null,this.priorities=[{value:1,label:"D\xFC\u015F\xFCk"},{value:2,label:"Orta"},{value:3,label:"Y\xFCksek"},{value:4,label:"Kritik"}],this.priorityOptions=[]}ngOnInit(){this.getTenantId(),this.loadLookups(),this.tenantId&&this.loadProducts(),this.route.queryParams.subscribe(t=>{t.productId&&(this.ticket.productId=parseInt(t.productId,10))})}loadLookups(){this.systemParameterService.getByGroup("TicketPriority").subscribe({next:t=>{let r=t.data||t||[];this.priorityOptions=(r||[]).map(e=>({value:Number(e.sortOrder??e.id),label:e.value??e.description??e.key})),this.priorityOptions.length&&(this.priorities=this.priorityOptions.map(l=>({value:l.value,label:l.label})),this.priorities.some(l=>Number(l.value)===Number(this.ticket.priority))||(this.ticket.priority=Number(this.priorities[0].value)))},error:()=>{}})}getTenantId(){let t=this.authService.getCurrentUser();t&&t.identifier&&(this.tenantId=parseInt(t.identifier,10))}loadProducts(){if(!this.tenantId){this.isLoading=!1;return}this.isLoading=!0,this.productService.getTenantProducts(this.tenantId).subscribe({next:t=>{this.products=t.data||t||[],this.isLoading=!1},error:()=>{this.isLoading=!1}})}onSubmit(){if(this.titleError="",!this.ticket.title||!this.ticket.description){this.errorMessage="L\xFCtfen ba\u015Fl\u0131k ve a\xE7\u0131klama alanlar\u0131n\u0131 doldurun.";return}if((this.ticket.title||"").trim().length<3){this.titleError="Ba\u015Fl\u0131k en az 3 karakter olmal\u0131d\u0131r.",this.errorMessage=this.titleError;return}this.isSubmitting=!0,this.errorMessage="";let t={title:this.ticket.title,description:this.ticket.description,priority:Number(this.ticket.priority),productId:this.ticket.productId||void 0};this.ticketService.createTicket(t).subscribe({next:r=>{let e=r.ticketId;this.selectedFile&&e?this.uploadImage(e):(this.successMessage="Destek talebiniz ba\u015Far\u0131yla olu\u015Fturuldu!",this.isSubmitting=!1,setTimeout(()=>{this.router.navigate(["/customer/tickets"])},1500))},error:r=>{let e=r.error||{},l="Talep olu\u015Fturulurken bir hata olu\u015Ftu.",p={title:"Ba\u015Fl\u0131k",description:"A\xE7\u0131klama",productId:"\xDCr\xFCn",priority:"\xD6ncelik"};if(e.errors&&typeof e.errors=="object"){let c=[];Object.keys(e.errors).forEach(T=>{let y=e.errors[T],V=p[T]||T;Array.isArray(y)?c.push(`${V}: ${y.join(", ")}`):typeof y=="string"&&c.push(`${V}: ${y}`)}),c.length&&(l=c.join(" | "))}else e.message?l=e.message:r.error&&typeof r.error=="string"&&(l=r.error);this.errorMessage=l,this.isSubmitting=!1}})}onFileSelected(t){let r=t.target.files[0];if(r){if(r.size>5*1024*1024){this.errorMessage="Dosya boyutu 5MB'\u0131 ge\xE7emez.";return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(r.type)){this.errorMessage="Yaln\u0131zca JPG, PNG, GIF ve WebP dosyalar\u0131 y\xFCklenebilir.";return}this.selectedFile=r,this.selectedFileName=r.name,this.errorMessage="";let l=new FileReader;l.onload=p=>{this.imagePreviewUrl=p.target.result},l.readAsDataURL(r)}}clearFile(){this.selectedFile=null,this.selectedFileName="",this.imagePreviewUrl=null}uploadImage(t){if(!this.selectedFile)return;let r=new FormData;r.append("file",this.selectedFile),this.ticketService.uploadTicketImage(t,r).subscribe({next:()=>{this.successMessage="Destek talebiniz ve resim ba\u015Far\u0131yla y\xFCklendi!",this.isSubmitting=!1,this.clearFile(),setTimeout(()=>{this.router.navigate(["/customer/tickets"])},1500)},error:e=>{this.successMessage="Destek talebiniz olu\u015Fturuldu ancak resim y\xFCklenemedi.",this.isSubmitting=!1,setTimeout(()=>{this.router.navigate(["/customer/tickets"])},1500)}})}static{this.\u0275fac=function(r){return new(r||o)(h(te),h(ie),h(R),h(ee),h(G),h(D))}}static{this.\u0275cmp=z({type:o,selectors:[["app-customer-ticket-create"]],standalone:!0,features:[j],decls:62,vars:11,consts:[["fileInput",""],[1,"customer-ticket-create"],[1,"page-header"],["routerLink","/customer/tickets",1,"back-link"],["width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["points","15 18 9 12 15 6"],[1,"alert","alert-success"],[1,"alert","alert-error"],[1,"form-card"],[3,"ngSubmit"],[1,"form-group"],["for","title"],[1,"required"],["type","text","id","title","name","title","placeholder","Sorununuzu k\u0131saca a\xE7\u0131klayan bir ba\u015Fl\u0131k yaz\u0131n","required","",3,"ngModelChange","input","ngModel"],[1,"error-text"],["for","description"],["id","description","name","description","rows","6","placeholder","Sorununuzu detayl\u0131 \u015Fekilde a\xE7\u0131klay\u0131n. Ne zaman ba\u015Flad\u0131, ne s\u0131kl\u0131kla oluyor, hangi hata mesajlar\u0131n\u0131 g\xF6r\xFCyorsunuz?","required","",3,"ngModelChange","ngModel"],["for","image"],[1,"file-upload-container"],["type","file","id","image","accept","image/*",1,"file-input",3,"change"],["for","image",1,"file-upload-label"],["width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"],["points","17 8 12 3 7 8"],["x1","12","y1","3","x2","12","y2","15"],[1,"file-text"],[1,"file-hint"],[1,"file-selected"],[1,"image-preview"],[1,"form-row"],["for","priority"],["id","priority","name","priority",3,"ngModelChange","ngModel"],[3,"value"],["for","product"],["id","product","disabled",""],[1,"form-actions"],["routerLink","/customer/tickets",1,"btn-cancel"],["type","submit",1,"btn-submit",3,"disabled"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M22 11.08V12a10 10 0 1 1-5.93-9.14"],["points","22 4 12 14.01 9 11.01"],["cx","12","cy","12","r","10"],["x1","15","y1","9","x2","9","y2","15"],["x1","9","y1","9","x2","15","y2","15"],["type","button",1,"clear-file",3,"click"],["alt","Resim \xF6nizlemesi",3,"src"],["id","product","name","productId",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"spinner"],["x1","22","y1","2","x2","11","y2","13"],["points","22 2 15 22 11 13 2 9 22 2"]],template:function(r,e){if(r&1){let l=S();i(0,"div",1)(1,"div",2)(2,"a",3),_(),i(3,"svg",4),g(4,"polyline",5),n(),a(5," Geri D\xF6n "),n(),w(),i(6,"h1"),a(7,"Yeni Destek Talebi"),n(),i(8,"p"),a(9,"Yeni bir destek talebi olu\u015Fturmak i\xE7in a\u015Fa\u011F\u0131daki formu doldurun."),n()(),x(10,re,5,1,"div",6)(11,ae,6,1,"div",7),i(12,"div",8)(13,"form",9),k("ngSubmit",function(){return u(l),m(e.onSubmit())}),i(14,"div",10)(15,"label",11),a(16,"Ba\u015Fl\u0131k "),i(17,"span",12),a(18,"*"),n()(),i(19,"input",13),v("ngModelChange",function(c){return u(l),O(e.ticket.title,c)||(e.ticket.title=c),m(c)}),k("input",function(){return u(l),m(e.titleError="")}),n(),x(20,le,2,1,"small",14),n(),i(21,"div",10)(22,"label",15),a(23,"A\xE7\u0131klama "),i(24,"span",12),a(25,"*"),n()(),i(26,"textarea",16),v("ngModelChange",function(c){return u(l),O(e.ticket.description,c)||(e.ticket.description=c),m(c)}),n()(),i(27,"div",10)(28,"label",17),a(29,"Resim Ekle (Opsiyonel)"),n(),i(30,"div",18)(31,"input",19,0),k("change",function(c){return u(l),m(e.onFileSelected(c))}),n(),i(33,"label",20),_(),i(34,"svg",21),g(35,"path",22)(36,"polyline",23)(37,"line",24),n(),w(),i(38,"span",25),a(39,"Resim se\xE7mek i\xE7in t\u0131klay\u0131n veya s\xFCr\xFCkleyin"),n(),i(40,"span",26),a(41,"(JPG, PNG, GIF, WebP - Max 5MB)"),n()()(),x(42,se,8,1,"div",27)(43,ce,2,1,"div",28),n(),i(44,"div",29)(45,"div",10)(46,"label",30),a(47,"\xD6ncelik"),n(),i(48,"select",31),v("ngModelChange",function(c){return u(l),O(e.ticket.priority,c)||(e.ticket.priority=c),m(c)}),E(49,de,2,2,"option",32,ne),n()(),i(51,"div",10)(52,"label",33),a(53,"\u0130lgili \xDCr\xFCn"),n(),x(54,pe,3,0,"select",34)(55,me,5,2),n()(),i(56,"div",35)(57,"a",36),a(58,"\u0130ptal"),n(),i(59,"button",37),x(60,ge,2,0)(61,fe,4,0),n()()()()()}r&2&&(s(10),C(10,e.successMessage?10:-1),s(),C(11,e.errorMessage?11:-1),s(8),P("ngModel",e.ticket.title),s(),C(20,e.titleError?20:-1),s(6),P("ngModel",e.ticket.description),s(16),C(42,e.selectedFileName?42:-1),s(),C(43,e.imagePreviewUrl?43:-1),s(5),P("ngModel",e.ticket.priority),s(),F(e.priorities),s(5),C(54,e.isLoading?54:55),s(5),b("disabled",e.isSubmitting),s(),C(60,e.isSubmitting?60:61))},dependencies:[L,W,B,$,J,Q,X,A,K,U,q,Z,H,Y],styles:[`.customer-ticket-create[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:25px}.page-header[_ngcontent-%COMP%]   .back-link[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;color:#6c757d;text-decoration:none;font-size:14px;margin-bottom:15px;transition:color .2s}.page-header[_ngcontent-%COMP%]   .back-link[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke-linecap:round;stroke-linejoin:round}.page-header[_ngcontent-%COMP%]   .back-link[_ngcontent-%COMP%]:hover{color:#0a6847}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:26px;font-weight:600;color:#1a1a2e;margin:0 0 6px}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6c757d;font-size:14px;margin:0}.alert[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:15px 20px;border-radius:10px;margin-bottom:20px;font-size:14px}.alert[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0;stroke-linecap:round;stroke-linejoin:round}.alert-success[_ngcontent-%COMP%]{background:#d1fae5;color:#065f46;border:1px solid #a7f3d0}.alert-error[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:30px;box-shadow:0 2px 8px #0000000f}.form-group[_ngcontent-%COMP%]{margin-bottom:22px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:500;color:#374151;margin-bottom:8px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:#ef4444}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:12px 15px;border:2px solid #e5e7eb;border-radius:10px;font-size:14px;font-family:inherit;transition:all .2s;background:#fff}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#0a6847;box-shadow:0 0 0 3px #0a68471a}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:disabled{background:#f3f4f6;cursor:not-allowed}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;min-height:120px;line-height:1.5}.form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{cursor:pointer;background:#fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E") no-repeat right 15px center;appearance:none;padding-right:40px}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px}.file-upload-container[_ngcontent-%COMP%]{position:relative;display:block;margin-bottom:12px}.file-upload-container[_ngcontent-%COMP%]   .file-input[_ngcontent-%COMP%]{display:none}.file-upload-container[_ngcontent-%COMP%]   .file-upload-label[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:30px;border:2px dashed #d1d5db;border-radius:10px;background:linear-gradient(135deg,#f9fafb,#f3f4f6);cursor:pointer;transition:all .3s}.file-upload-container[_ngcontent-%COMP%]   .file-upload-label[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#6b7280;stroke-width:1.5}.file-upload-container[_ngcontent-%COMP%]   .file-upload-label[_ngcontent-%COMP%]   .file-text[_ngcontent-%COMP%]{font-weight:500;color:#374151;text-align:center}.file-upload-container[_ngcontent-%COMP%]   .file-upload-label[_ngcontent-%COMP%]   .file-hint[_ngcontent-%COMP%]{font-size:12px;color:#9ca3af}.file-upload-container[_ngcontent-%COMP%]   .file-upload-label[_ngcontent-%COMP%]:hover{border-color:#0a6847;background:linear-gradient(135deg,#ecfdf5,#d1fae5)}.file-upload-container[_ngcontent-%COMP%]   .file-upload-label[_ngcontent-%COMP%]:hover   svg[_ngcontent-%COMP%]{color:#0a6847}.file-upload-container[_ngcontent-%COMP%]   .file-upload-label[_ngcontent-%COMP%]:hover   .file-text[_ngcontent-%COMP%]{color:#0a6847}.file-selected[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:12px 15px;background:#d1fae5;border:1px solid #a7f3d0;border-radius:8px;color:#065f46;font-size:14px;margin-bottom:12px}.file-selected[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0;stroke-linecap:round;stroke-linejoin:round}.file-selected[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;word-break:break-word}.file-selected[_ngcontent-%COMP%]   .clear-file[_ngcontent-%COMP%]{background:none;border:none;color:#065f46;cursor:pointer;font-size:16px;padding:4px 8px;flex-shrink:0;transition:all .2s;border-radius:4px}.file-selected[_ngcontent-%COMP%]   .clear-file[_ngcontent-%COMP%]:hover{background:#065f461a}.image-preview[_ngcontent-%COMP%]{margin-top:12px;border-radius:10px;overflow:hidden;border:2px solid #e5e7eb;max-height:300px}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto;display:block}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:30px;padding-top:20px;border-top:1px solid #f1f3f4}.btn-cancel[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:12px 24px;background:#f3f4f6;color:#4b5563;border:none;border-radius:10px;font-size:14px;font-weight:500;text-decoration:none;cursor:pointer;transition:all .2s}.btn-cancel[_ngcontent-%COMP%]:hover{background:#e5e7eb}.btn-submit[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 28px;background:linear-gradient(135deg,#0a6847,#0d8b5e);color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.btn-submit[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke-linecap:round;stroke-linejoin:round}.btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 15px #0a68474d}.btn-submit[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.btn-submit[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{padding:20px}.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.btn-cancel[_ngcontent-%COMP%], .btn-submit[_ngcontent-%COMP%]{width:100%}.file-upload-label[_ngcontent-%COMP%]{padding:20px!important}}@media (max-width: 480px){.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:22px}}`]})}}return o})();export{ye as CustomerTicketCreateComponent};
