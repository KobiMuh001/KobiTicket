import{a as $}from"./chunk-LMBHDFGG.js";import{a as H}from"./chunk-SV5AFNMF.js";import{a as U}from"./chunk-HWFY6JGU.js";import{d as I,e as D,f as F,g as z,i as A}from"./chunk-AVDF5BY2.js";import{K as O,La as m,Na as T,Pa as M,Sa as u,Ub as R,Va as k,Wa as w,Wb as j,Xa as n,Ya as a,Z as S,Za as d,ab as v,bb as g,cb as l,fa as x,ga as h,ha as p,hb as f,i as P,ia as y,ib as C,jb as E,qb as V,sa as L,wa as N,ya as r,za as b}from"./chunk-ECSZKSZ4.js";var G=(e,c)=>c.route,B=(e,c)=>c.id;function K(e,c){e&1&&(n(0,"div",3),d(1,"img",24),a())}function q(e,c){e&1&&(p(),d(0,"polyline",6))}function W(e,c){e&1&&(p(),d(0,"polyline",25))}function Y(e,c){e&1&&(p(),n(0,"svg",5),d(1,"path",29)(2,"polyline",30),a())}function J(e,c){e&1&&(p(),n(0,"svg",5),d(1,"path",31)(2,"polyline",32)(3,"line",33)(4,"line",34),a())}function Q(e,c){e&1&&(p(),n(0,"svg",5),d(1,"rect",35)(2,"path",36),a())}function X(e,c){e&1&&(p(),n(0,"svg",5),d(1,"path",37)(2,"circle",38),a())}function Z(e,c){if(e&1&&(n(0,"span",28),f(1),a()),e&2){let t=l().$implicit;r(),C(t.title)}}function tt(e,c){if(e&1&&(n(0,"li",9)(1,"a",26)(2,"span",27),m(3,Y,3,0)(4,J,5,0)(5,Q,3,0)(6,X,3,0),a(),m(7,Z,2,1,"span",28),a()()),e&2){let t,i=c.$implicit,o=l();r(),T("routerLink",i.route),r(2),u(3,(t=i.icon)==="home"?3:t==="ticket"?4:t==="assets"?5:t==="profile"?6:-1),r(4),u(7,o.isSidebarCollapsed?-1:7)}}function et(e,c){if(e&1&&(n(0,"div",11)(1,"div",39)(2,"span"),f(3),a()(),n(4,"div",40)(5,"span",41),f(6),a(),n(7,"span",42),f(8,"M\xFC\u015Fteri"),a()()()),e&2){let t=l();r(3),C(((t.currentUser==null?null:t.currentUser.fullName)||(t.currentUser==null?null:t.currentUser.companyName)||"M").charAt(0)),r(3),C((t.currentUser==null?null:t.currentUser.fullName)||(t.currentUser==null?null:t.currentUser.companyName)||"M\xFC\u015Fteri")}}function nt(e,c){if(e&1&&(n(0,"span",22),f(1),a()),e&2){let t=l();r(),C(t.unreadNotificationsCount)}}function it(e,c){if(e&1){let t=v();n(0,"span",47),f(1),a(),n(2,"button",48),g("click",function(o){x(t);let s=l(2);return h(s.markAllNotificationsAsRead(o))}),f(3," Tumunu Okundu Isaretle "),a()}if(e&2){let t=l(2);r(),E("",t.unreadNotificationsCount," yeni")}}function ot(e,c){e&1&&(n(0,"div",46)(1,"p"),f(2,"Hen\xFCz bildirim yok"),a()())}function at(e,c){if(e&1){let t=v();n(0,"button",65),g("click",function(o){x(t);let s=l().$implicit,_=l(3);return h(_.markNotificationAsRead(s.id,o))}),p(),n(1,"svg",60),d(2,"polyline",66),a()()}}function rt(e,c){if(e&1){let t=v();n(0,"tr",51),g("click",function(){let o=x(t).$implicit,s=l(3);return h(s.onNotificationClick(o))}),n(1,"td",52)(2,"div",53)(3,"p",54),f(4),a(),n(5,"p",55),f(6),a()()(),n(7,"td",56),f(8),a(),n(9,"td",57),m(10,at,3,0,"button",58),n(11,"button",59),g("click",function(o){let s=x(t).$implicit,_=l(3);return h(_.deleteNotification(s.id,o))}),p(),n(12,"svg",60),d(13,"polyline",61)(14,"path",62)(15,"line",63)(16,"line",64),a()()()()}if(e&2){let t=c.$implicit,i=l(3);M("unread",!t.isRead),r(4),C(t.title),r(2),C(t.message),r(2),C(i.formatDate(t.createdDate)),r(2),u(10,t.isRead?-1:10)}}function ct(e,c){if(e&1&&(n(0,"table",49)(1,"tbody"),k(2,rt,17,6,"tr",50,B),a()()),e&2){let t=l(2);r(2),w(t.notifications.slice(0,5))}}function lt(e,c){if(e&1){let t=v();n(0,"div",43),g("click",function(o){return x(t),h(o.stopPropagation())}),n(1,"div",44)(2,"h3"),f(3,"Bildirimler"),a(),m(4,it,4,1),a(),n(5,"div",45),m(6,ot,3,0,"div",46)(7,ct,4,0),a()()}if(e&2){let t=l();r(4),u(4,t.unreadNotificationsCount>0?4:-1),r(2),u(6,t.notifications.length===0?6:7)}}var yt=(()=>{class e{constructor(t,i,o,s,_){this.authService=t,this.notificationService=i,this.signalRService=o,this.router=s,this.platformId=_,this.isSidebarCollapsed=!1,this.currentUser=null,this.notifications=[],this.showNotificationsDropdown=!1,this.destroy$=new P,this.menuItems=[{title:"Ana Sayfa",icon:"home",route:"/customer/dashboard"},{title:"Ticketlar\u0131m",icon:"ticket",route:"/customer/tickets"},{title:"Varl\u0131klar\u0131m",icon:"assets",route:"/customer/assets"},{title:"Profilim",icon:"profile",route:"/customer/profile"}],this.isBrowser=j(this.platformId)}ngOnInit(){if(this.authService.currentUser$.subscribe(t=>{this.currentUser=t}),this.notificationService.notificationsList$.pipe(O(this.destroy$)).subscribe(t=>{this.notifications=(t||[]).filter(i=>i.type==="TicketStatusChanged"||i.type==="TicketComment")}),this.notificationService.initializeCustomerNotifications(),this.isBrowser){let t=localStorage.getItem("token")||sessionStorage.getItem("token");t&&this.signalRService.startNotificationConnection(t).then(()=>{let i=this.signalRService.getNotificationHub();i?.off("CustomerNotificationReceived"),i?.on("CustomerNotificationReceived",o=>{this.notificationService.addStaffNotificationDirectly(o)})}).catch(i=>{console.error("Customer Layout: SignalR Notification Hub ba\u011Flant\u0131 hatas\u0131:",i)})}}ngOnDestroy(){this.notificationService.stopPolling(),this.signalRService.stopNotificationConnection().catch(()=>{}),this.destroy$.next(),this.destroy$.complete()}get unreadNotificationsCount(){return this.notifications.filter(t=>!t.isRead).length}formatDate(t){return new Date(t).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}toggleNotificationsDropdown(t){t&&t.stopPropagation(),this.showNotificationsDropdown=!this.showNotificationsDropdown}closeNotificationsDropdown(){this.showNotificationsDropdown=!1}markNotificationAsRead(t,i){i&&i.stopPropagation(),this.notificationService.markAsRead(t).subscribe()}deleteNotification(t,i){i&&i.stopPropagation(),this.notificationService.deleteNotification(t).subscribe()}markAllNotificationsAsRead(t){t&&t.stopPropagation(),this.notificationService.markAllAsRead().subscribe()}onNotificationClick(t){t.isRead||this.notificationService.markAsRead(t.id).subscribe(),t.ticketId&&this.router.navigate(["/customer/tickets",t.ticketId]),this.closeNotificationsDropdown()}onDocumentClick(t){let i=t.target,o=document.querySelector(".notifications-widget");o&&!o.contains(i)&&this.closeNotificationsDropdown()}toggleSidebar(){this.isSidebarCollapsed=!this.isSidebarCollapsed}logout(){this.authService.logout()}static{this.\u0275fac=function(i){return new(i||e)(b(H),b($),b(U),b(D),b(L))}}static{this.\u0275cmp=S({type:e,selectors:[["app-customer-layout"]],hostBindings:function(i,o){i&1&&g("click",function(_){return o.onDocumentClick(_)},!1,N)},standalone:!0,features:[V],decls:29,vars:9,consts:[[1,"customer-layout"],[1,"sidebar"],[1,"sidebar-header"],[1,"logo"],[1,"sidebar-toggle",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["points","9 18 15 12 9 6"],[1,"sidebar-nav"],[1,"nav-list"],[1,"nav-item"],[1,"sidebar-footer"],[1,"user-info"],["title","\xC7\u0131k\u0131\u015F Yap",1,"logout-btn",3,"click"],["d","M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"],["points","16 17 21 12 16 7"],["x1","21","y1","12","x2","9","y2","12"],[1,"main-content"],[1,"topbar"],[1,"notifications-widget"],[1,"notification-toggle",3,"click"],["d","M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"],["d","M13.73 21a2 2 0 0 1-3.46 0"],[1,"notification-badge"],[1,"notifications-dropdown"],["src","assets/images/KobiLogo.png","alt","Kobi M\xFChendislik",1,"logo-img"],["points","15 18 9 12 15 6"],["routerLinkActive","active",1,"nav-link",3,"routerLink"],[1,"nav-icon"],[1,"nav-text"],["d","M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"],["points","9 22 9 12 15 12 15 22"],["d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"],["points","14 2 14 8 20 8"],["x1","16","y1","13","x2","8","y2","13"],["x1","16","y1","17","x2","8","y2","17"],["x","2","y","7","width","20","height","14","rx","2","ry","2"],["d","M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"],["d","M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"],["cx","12","cy","7","r","4"],[1,"user-avatar"],[1,"user-details"],[1,"user-name"],[1,"user-role"],[1,"notifications-dropdown",3,"click"],[1,"dropdown-header"],[1,"notifications-list"],[1,"empty-state"],[1,"unread-count"],[1,"mark-all-btn",3,"click"],[1,"notifications-table"],[1,"notification-row",3,"unread"],[1,"notification-row",3,"click"],[1,"notification-cell"],[1,"notification-content"],[1,"notification-title"],[1,"notification-message"],[1,"notification-date"],[1,"notification-actions-cell"],["title","Okundu olarak i\u015Faretle",1,"mark-read-btn"],["title","Sil",1,"delete-btn",3,"click"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["points","3 6 5 6 21 6"],["d","M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"],["x1","10","y1","11","x2","10","y2","17"],["x1","14","y1","11","x2","14","y2","17"],["title","Okundu olarak i\u015Faretle",1,"mark-read-btn",3,"click"],["points","20 6 9 17 4 12"]],template:function(i,o){i&1&&(n(0,"div",0)(1,"aside",1)(2,"div",2),m(3,K,2,0,"div",3),n(4,"button",4),g("click",function(){return o.toggleSidebar()}),p(),n(5,"svg",5),m(6,q,1,0,":svg:polyline",6)(7,W,1,0),a()()(),y(),n(8,"nav",7)(9,"ul",8),k(10,tt,8,3,"li",9,G),a()(),n(12,"div",10),m(13,et,9,2,"div",11),n(14,"button",12),g("click",function(){return o.logout()}),p(),n(15,"svg",5),d(16,"path",13)(17,"polyline",14)(18,"line",15),a()()()(),y(),n(19,"main",16)(20,"div",17)(21,"div",18)(22,"button",19),g("click",function(_){return o.toggleNotificationsDropdown(_)}),p(),n(23,"svg",5),d(24,"path",20)(25,"path",21),a(),m(26,nt,2,1,"span",22),a(),m(27,lt,8,2,"div",23),a()(),y(),d(28,"router-outlet"),a()()),i&2&&(M("sidebar-collapsed",o.isSidebarCollapsed),r(3),u(3,o.isSidebarCollapsed?-1:3),r(3),u(6,o.isSidebarCollapsed?6:7),r(4),w(o.menuItems),r(3),u(13,o.isSidebarCollapsed?-1:13),r(9),M("has-unread",o.unreadNotificationsCount>0),r(4),u(26,o.unreadNotificationsCount>0?26:-1),r(),u(27,o.showNotificationsDropdown?27:-1))},dependencies:[R,A,I,F,z],styles:[".customer-layout[_ngcontent-%COMP%]{display:flex;min-height:100vh;background:#f8f9fc;overflow-x:hidden}.sidebar[_ngcontent-%COMP%]{width:260px;background:linear-gradient(180deg,#1a365d,#2563eb);display:flex;flex-direction:column;transition:width .3s ease;position:fixed;left:0;top:0;height:100vh;z-index:100;box-shadow:2px 0 10px #0000001a}.sidebar-collapsed[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{width:70px}.sidebar-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:20px 15px;border-bottom:1px solid rgba(255,255,255,.1)}.logo[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.logo[_ngcontent-%COMP%]   .logo-img[_ngcontent-%COMP%]{width:160px;height:auto;object-fit:contain}.logo-text[_ngcontent-%COMP%]{color:#fff;font-size:18px;font-weight:600;white-space:nowrap}.sidebar-toggle[_ngcontent-%COMP%]{background:#ffffff1a;border:none;color:#fff;width:32px;height:32px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.sidebar-toggle[_ngcontent-%COMP%]:hover{background:#fff3}.sidebar-nav[_ngcontent-%COMP%]{flex:1;padding:15px 10px;overflow-y:auto}.nav-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.nav-item[_ngcontent-%COMP%]{margin-bottom:5px}.nav-link[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 15px;color:#ffffffd9;text-decoration:none;border-radius:10px;transition:all .2s}.nav-link[_ngcontent-%COMP%]:hover{background:#ffffff26;color:#fff}.nav-link.active[_ngcontent-%COMP%]{background:#fff3;color:#fff;font-weight:500;box-shadow:0 2px 8px #0000001a}.nav-icon[_ngcontent-%COMP%]{width:20px;height:20px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.nav-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke-linecap:round;stroke-linejoin:round}.nav-text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.sidebar-footer[_ngcontent-%COMP%]{padding:15px;border-top:1px solid rgba(255,255,255,.1);display:flex;align-items:center;gap:10px}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex:1;min-width:0}.user-avatar[_ngcontent-%COMP%]{width:38px;height:38px;background:#fff3;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.user-avatar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff;font-weight:600;font-size:16px}.user-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:0}.user-name[_ngcontent-%COMP%]{color:#fff;font-size:14px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.user-role[_ngcontent-%COMP%]{color:#ffffffb3;font-size:12px}.logout-btn[_ngcontent-%COMP%]{background:#ffffff1a;border:none;color:#fffc;width:38px;height:38px;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}.logout-btn[_ngcontent-%COMP%]:hover{background:#ef4444cc;color:#fff}.main-content[_ngcontent-%COMP%]{flex:1;margin-left:260px;padding:25px;transition:margin-left .3s ease;min-height:100vh}.sidebar-collapsed[_ngcontent-%COMP%]   .main-content[_ngcontent-%COMP%]{margin-left:70px}.topbar[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;margin-bottom:16px}.notifications-widget[_ngcontent-%COMP%]{position:relative}.notification-toggle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:#fff;border:1px solid #e2e8f0;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;color:#64748b;position:relative}.notification-toggle[_ngcontent-%COMP%]:hover{background:#f8fafc;border-color:#cbd5e1}.notification-toggle.has-unread[_ngcontent-%COMP%]{color:#ef4444;background:#fef2f2;border-color:#fecaca}.notification-badge[_ngcontent-%COMP%]{position:absolute;top:-6px;right:-6px;background:#ef4444;color:#fff;font-size:11px;font-weight:600;width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:2px solid #fff}.notifications-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;width:500px;z-index:1000;margin-top:8px;background:#fff;border-radius:12px;box-shadow:0 10px 25px #00000026;border:1px solid #f1f5f9;overflow:hidden}.dropdown-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1.25rem 1.5rem;border-bottom:1px solid #f1f5f9}.dropdown-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#1e293b;margin:0}.dropdown-header[_ngcontent-%COMP%]   .unread-count[_ngcontent-%COMP%]{font-size:.75rem;background:#dbeafe;color:#1e40af;padding:.25rem .5rem;border-radius:4px;font-weight:500}.dropdown-header[_ngcontent-%COMP%]   .mark-all-btn[_ngcontent-%COMP%]{background:#e0e7ff;color:#1e40af;border:none;padding:.35rem .6rem;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;margin-left:8px}.notifications-list[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.notifications-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.notifications-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.notifications-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.notifications-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.notifications-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.notifications-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #f1f5f9;transition:background .2s}.notifications-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child{border-bottom:none}.notifications-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8fafc}.notifications-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.unread[_ngcontent-%COMP%]{background:#f0fdf4}.notifications-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.unread[_ngcontent-%COMP%]:hover{background:#ecfdf5}.notification-cell[_ngcontent-%COMP%]{padding:14px 16px;width:65%}.notification-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.notification-title[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:600;color:#0f172a}.notification-message[_ngcontent-%COMP%]{margin:0;font-size:12px;color:#64748b}.notification-date[_ngcontent-%COMP%]{padding:14px 12px;font-size:12px;color:#94a3b8;white-space:nowrap}.notification-actions-cell[_ngcontent-%COMP%]{padding:10px 12px;display:flex;gap:6px;align-items:center;justify-content:flex-end}.mark-read-btn[_ngcontent-%COMP%], .delete-btn[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:6px;border:1px solid #e2e8f0;background:#fff;color:#64748b;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.mark-read-btn[_ngcontent-%COMP%]:hover, .delete-btn[_ngcontent-%COMP%]:hover{background:#f8fafc;color:#0f172a}.delete-btn[_ngcontent-%COMP%]:hover{background:#fef2f2;color:#dc2626;border-color:#fecaca}.empty-state[_ngcontent-%COMP%]{padding:20px;text-align:center;color:#94a3b8;font-size:13px}@media (max-width: 768px){.notifications-dropdown[_ngcontent-%COMP%]{width:320px}}@media (max-width: 480px){.notifications-dropdown[_ngcontent-%COMP%]{width:300px;right:-20px}}.sidebar-collapsed[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:none}.sidebar-collapsed[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{justify-content:center;padding:12px}.sidebar-collapsed[_ngcontent-%COMP%]   .sidebar-footer[_ngcontent-%COMP%]{justify-content:center}.sidebar-collapsed[_ngcontent-%COMP%]   .logout-btn[_ngcontent-%COMP%]{margin:0 auto}@media (max-width: 768px){.sidebar[_ngcontent-%COMP%]{width:70px}.main-content[_ngcontent-%COMP%]{margin-left:70px;padding:16px}.logo[_ngcontent-%COMP%], .logo-text[_ngcontent-%COMP%], .nav-text[_ngcontent-%COMP%], .user-info[_ngcontent-%COMP%]{display:none}.sidebar-header[_ngcontent-%COMP%]{padding:12px 10px;justify-content:center}.sidebar-nav[_ngcontent-%COMP%]{padding:10px 8px}.nav-link[_ngcontent-%COMP%]{justify-content:center;padding:10px}.sidebar-footer[_ngcontent-%COMP%]{padding:10px;justify-content:center}}@media (max-width: 480px){.sidebar[_ngcontent-%COMP%]{width:60px}.main-content[_ngcontent-%COMP%]{margin-left:60px;padding:15px}}"]})}}return e})();export{yt as CustomerLayoutComponent};
