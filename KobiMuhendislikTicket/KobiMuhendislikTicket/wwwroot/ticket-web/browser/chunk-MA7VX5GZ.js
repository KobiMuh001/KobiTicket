import{a as gt}from"./chunk-V3F3MMBH.js";import{a as mt}from"./chunk-2R6TGZNO.js";import{a as st}from"./chunk-POCSGDA3.js";import{b as nt,c as it,f as ot,i as at,j as rt,k as lt,r as ct}from"./chunk-PRZMQGB5.js";import{a as dt}from"./chunk-3F3BRH62.js";import{c as X,e as Z,i as tt}from"./chunk-RCMVJVUR.js";import{La as p,Na as O,Oa as z,Pa as y,Qa as N,Sa as g,Ta as $,Ua as W,Va as S,Wa as T,Wb as J,Xa as i,Ya as o,Yb as q,Z as G,Za as f,a as B,ab as v,b as F,bb as h,cb as m,d as j,eb as U,fa as u,fb as K,fc as et,ga as x,gb as Y,ha as M,ia as w,ib as l,jb as _,kb as k,nb as R,ob as D,pb as A,rb as Q,sa as H,ua as E,w as L,ya as c,za as P}from"./chunk-W3I5MFZP.js";var _t=["commentsContainer"],pt=(n,d)=>d.id;function ft(n,d){if(n&1&&(i(0,"div",7)(1,"h1"),l(2),o(),i(3,"span",11),l(4),o(),i(5,"span",11),l(6),o()()),n&2){let t=m();c(2),k("Talep ",t.formatTicketId(t.ticket.id,t.ticket.ticketCode),""),c(),N("badge--"+t.getStatusClass(t.ticket.status)),z("background-color",t.getStatusColor(t.ticket.status))("color",t.getStatusColor(t.ticket.status)?"#fff":null),c(),k(" ",t.getStatusLabel(t.ticket.status)," "),c(),N("badge--"+t.getPriorityClass(t.ticket.priority)),z("background-color",t.getPriorityColor(t.ticket.priority))("color",t.getPriorityColor(t.ticket.priority)?"#fff":null),c(),k(" ",t.getPriorityLabel(t.ticket.priority)," ")}}function Ct(n,d){if(n&1){let t=v();i(0,"button",12),h("click",function(){u(t);let e=m();return x(e.goToEdit())}),M(),i(1,"svg",13),f(2,"path",14)(3,"path",15),o(),l(4," D\xFCzenle "),o()}}function ut(n,d){n&1&&(i(0,"div",9),f(1,"div",16),i(2,"p"),l(3,"Y\xFCkleniyor..."),o()())}function xt(n,d){if(n&1){let t=v();i(0,"div",17),M(),i(1,"svg",18),f(2,"circle",19)(3,"path",20),o(),w(),i(4,"p"),l(5),o(),i(6,"button",12),h("click",function(){u(t);let e=m();return x(e.goBack())}),l(7,"Geri D\xF6n"),o()()}if(n&2){let t=m();c(5),_(t.error)}}function ht(n,d){if(n&1&&(i(0,"span",11),l(1),o()),n&2){let t=m(2);c(),_(t.comments.length)}}function bt(n,d){if(n&1&&(i(0,"span",11),l(1),o()),n&2){let t=m(2);c(),_(t.history.length)}}function vt(n,d){if(n&1){let t=v();i(0,"button",49),h("click",function(){let e=u(t).$implicit,r=m(4);return x(r.openImagePreview(e))}),f(1,"img",50),i(2,"div",51)(3,"span"),l(4,"Buyutmek icin tikla"),o()()()}if(n&2){let t=d.$implicit,a=m(4);c(),O("src",a.baseUrl+t,E)}}function Mt(n,d){if(n&1&&(i(0,"div",38)(1,"label"),l(2,"Ek Gorseller"),o(),i(3,"div",47),S(4,vt,5,1,"button",48,W),o()()),n&2){let t=m(3);c(4),T(t.ticket.imagePaths)}}function Pt(n,d){if(n&1){let t=v();i(0,"div",38)(1,"label"),l(2,"Ek Gorsel"),o(),i(3,"div",52)(4,"button",53),h("click",function(){u(t);let e=m(3);return x(e.openImagePreview(e.ticket.imagePath))}),f(5,"img",50),i(6,"div",51)(7,"span"),l(8,"Buyutmek icin tikla"),o()()()()()}if(n&2){let t=m(3);c(5),O("src",t.baseUrl+t.ticket.imagePath,E)}}function kt(n,d){if(n&1&&(i(0,"div",41)(1,"div",38)(2,"label"),l(3,"\xDCr\xFCn"),o(),i(4,"p",39),l(5),o()()()),n&2){let t=m(3);c(5),_(t.ticket.assetName)}}function wt(n,d){if(n&1&&(i(0,"div",43)(1,"label"),l(2,"\u015Eu an atanan"),o(),i(3,"div",54)(4,"div",55),l(5),o(),i(6,"span"),l(7),o()()()),n&2){let t=m(3);c(5),k(" ",t.ticket.assignedPerson.charAt(0).toUpperCase()," "),c(2),_(t.ticket.assignedPerson)}}function Ot(n,d){n&1&&(i(0,"div",44),f(1,"span",46),l(2," Personeller y\xFCkleniyor... "),o())}function yt(n,d){n&1&&(i(0,"p",56),l(1,"Aktif personel bulunamad\u0131"),o())}function St(n,d){if(n&1&&l(0),n&2){let t=m().$implicit;k(" (",t.department,") ")}}function Tt(n,d){if(n&1&&(i(0,"option",59),l(1),p(2,St,1,1),o()),n&2){let t=d.$implicit;O("value",t.id),c(),k(" ",t.fullName," "),c(),g(2,t.department?2:-1)}}function Vt(n,d){if(n&1){let t=v();i(0,"select",57),A("ngModelChange",function(e){u(t);let r=m(3);return D(r.selectedStaffId,e)||(r.selectedStaffId=e),x(e)}),i(1,"option",58),l(2,"-- Personel Se\xE7in --"),o(),S(3,Tt,3,3,"option",59,pt),o()}if(n&2){let t=m(3);R("ngModel",t.selectedStaffId),c(3),T(t.staffList)}}function Et(n,d){n&1&&f(0,"span",46)}function It(n,d){if(n&1){let t=v();i(0,"div",31)(1,"div",34)(2,"div",35)(3,"div",36)(4,"h2"),l(5,"Talep Bilgileri"),o()(),i(6,"div",37)(7,"div",38)(8,"label"),l(9,"Ba\u015Fl\u0131k"),o(),i(10,"p",39),l(11),o()(),i(12,"div",38)(13,"label"),l(14,"A\xE7\u0131klama"),o(),i(15,"p",40),l(16),o()(),p(17,Mt,6,0,"div",38)(18,Pt,9,1),i(19,"div",41)(20,"div",38)(21,"label"),l(22,"Olu\u015Fturulma"),o(),i(23,"p",39),l(24),o()(),i(25,"div",38)(26,"label"),l(27,"Son G\xFCncelleme"),o(),i(28,"p",39),l(29),o()()()()(),i(30,"div",35)(31,"div",36)(32,"h2"),l(33,"M\xFC\u015Fteri Bilgileri"),o()(),i(34,"div",37)(35,"div",38)(36,"label"),l(37,"Firma"),o(),i(38,"p",39),l(39),o()(),i(40,"div",41)(41,"div",38)(42,"label"),l(43,"E-posta"),o(),i(44,"p",39),l(45),o()(),i(46,"div",38)(47,"label"),l(48,"Telefon"),o(),i(49,"p",39),l(50),o()()(),p(51,kt,6,1,"div",41),o()()(),i(52,"div",42)(53,"div",35)(54,"div",36)(55,"h2"),l(56,"Atanan Ki\u015Fi"),o()(),i(57,"div",37),p(58,wt,8,2,"div",43),i(59,"div",38)(60,"label"),l(61,"Personel Se\xE7"),o(),p(62,Ot,3,0,"div",44)(63,yt,2,0)(64,Vt,5,1),o(),i(65,"button",45),h("click",function(){u(t);let e=m(2);return x(e.assignTicket())}),p(66,Et,1,0,"span",46),l(67," Ata "),o()()()()()}if(n&2){let t=m(2);c(11),_(t.ticket.title),c(5),_(t.ticket.description),c(),g(17,t.ticket.imagePaths!=null&&t.ticket.imagePaths.length?17:t.ticket.imagePath?18:-1),c(7),_(t.formatFullDate(t.ticket.createdDate)),c(5),_(t.ticket.updatedDate?t.formatFullDate(t.ticket.updatedDate):"Hen\xFCz g\xFCncellenmedi"),c(10),_(t.ticket.tenantName||"-"),c(6),_(t.ticket.tenantEmail||"-"),c(5),_(t.ticket.tenantPhone||"-"),c(),g(51,t.ticket.assetName?51:-1),c(7),g(58,t.ticket.assignedPerson?58:-1),c(4),g(62,t.loadingStaff?62:t.staffList.length===0?63:64),c(3),O("disabled",t.assigning||!t.selectedStaffId||t.loadingStaff),c(),g(66,t.assigning?66:-1)}}function Bt(n,d){n&1&&(i(0,"div",61),M(),i(1,"svg",18),f(2,"path",28),o(),w(),i(3,"p"),l(4,"Hen\xFCz yorum yok"),o()())}function Ft(n,d){n&1&&(i(0,"span",69),l(1,"DESTEK"),o())}function zt(n,d){if(n&1&&(i(0,"div",66)(1,"div",67)(2,"span",68),l(3),o(),p(4,Ft,2,0,"span",69),i(5,"span",70),l(6),o()(),i(7,"div",71),l(8),o()()),n&2){let t=d.$implicit,a=m(4);y("admin",t.isAdminReply&&!t.isStaff)("staff",t.isStaff),c(3),_(t.authorName),c(),g(4,t.isAdminReply?4:-1),c(2),_(a.formatDate(t.createdDate)),c(2),k(" ",t.message," ")}}function Nt(n,d){if(n&1&&S(0,zt,9,8,"div",65,pt),n&2){let t=m(3);T(t.comments)}}function Rt(n,d){n&1&&f(0,"span",46)}function Dt(n,d){if(n&1){let t=v();i(0,"div",32)(1,"div",35)(2,"div",36)(3,"h2"),l(4,"Mesajlar"),o()(),i(5,"div",37)(6,"div",60,0),p(8,Bt,5,0,"div",61)(9,Nt,2,0),o(),i(10,"div",62)(11,"textarea",63),A("ngModelChange",function(e){u(t);let r=m(2);return D(r.newComment,e)||(r.newComment=e),x(e)}),o(),i(12,"button",64),h("click",function(){u(t);let e=m(2);return x(e.addComment())}),p(13,Rt,1,0,"span",46),l(14," Mesaj G\xF6nder "),o()()()()()}if(n&2){let t=m(2);c(8),g(8,t.comments.length===0?8:9),c(3),R("ngModel",t.newComment),c(),O("disabled",t.addingComment||!t.newComment.trim()),c(),g(13,t.addingComment?13:-1)}}function At(n,d){n&1&&(i(0,"div",61),M(),i(1,"svg",18),f(2,"circle",19)(3,"polyline",29),o(),w(),i(4,"p"),l(5,"Ge\xE7mi\u015F kayd\u0131 yok"),o()())}function jt(n,d){if(n&1&&(i(0,"div",73),f(1,"div",74),i(2,"div",75)(3,"p",76),l(4),o(),i(5,"div",77)(6,"span",78),l(7),o(),i(8,"span",70),l(9),o()()()()),n&2){let t=d.$implicit,a=m(4);c(4),_(t.description),c(3),_(t.actionBy),c(2),_(a.formatFullDate(t.createdDate))}}function Lt(n,d){if(n&1&&(i(0,"div",72),S(1,jt,10,3,"div",73,$),o()),n&2){let t=m(3);c(),T(t.history)}}function Gt(n,d){if(n&1&&(i(0,"div",33)(1,"div",35)(2,"div",36)(3,"h2"),l(4,"\u0130\u015Flem Ge\xE7mi\u015Fi"),o()(),i(5,"div",37),p(6,At,6,0,"div",61)(7,Lt,3,0),o()()()),n&2){let t=m(2);c(6),g(6,t.history.length===0?6:7)}}function Ht(n,d){if(n&1){let t=v();i(0,"div",21)(1,"button",22),h("click",function(){u(t);let e=m();return x(e.activeTab="details")}),M(),i(2,"svg",13),f(3,"path",23)(4,"polyline",24)(5,"line",25)(6,"line",26)(7,"polyline",27),o(),l(8," Detaylar "),o(),w(),i(9,"button",22),h("click",function(){u(t);let e=m();return e.activeTab="comments",x(e.scrollToCommentsBottom())}),M(),i(10,"svg",13),f(11,"path",28),o(),l(12," Mesajlar "),p(13,ht,2,1,"span",11),o(),w(),i(14,"button",22),h("click",function(){u(t);let e=m();return x(e.activeTab="history")}),M(),i(15,"svg",13),f(16,"circle",19)(17,"polyline",29),o(),l(18," Ge\xE7mi\u015F "),p(19,bt,2,1,"span",11),o()(),w(),i(20,"div",30),p(21,It,68,13,"div",31)(22,Dt,15,4,"div",32)(23,Gt,8,1,"div",33),o()}if(n&2){let t=m();c(),y("active",t.activeTab==="details"),c(8),y("active",t.activeTab==="comments"),c(4),g(13,t.comments.length>0?13:-1),c(),y("active",t.activeTab==="history"),c(5),g(19,t.history.length>0?19:-1),c(2),g(21,t.activeTab==="details"?21:-1),c(),g(22,t.activeTab==="comments"?22:-1),c(),g(23,t.activeTab==="history"?23:-1)}}function $t(n,d){if(n&1){let t=v();i(0,"div",79),h("click",function(){u(t);let e=m();return x(e.showImagePreview=!1)}),i(1,"div",80),h("click",function(e){return u(t),x(e.stopPropagation())}),i(2,"button",81),h("click",function(){u(t);let e=m();return x(e.showImagePreview=!1)}),l(3,"x"),o(),f(4,"img",82),o()()}if(n&2){let t=m();c(4),O("src",t.baseUrl+t.selectedImagePath,E)}}var le=(()=>{class n{constructor(t,a,e,r,s,C,V){this.route=t,this.router=a,this.ticketService=e,this.signalRService=r,this.staffService=s,this.systemParameterService=C,this.ticket=null,this.comments=[],this.history=[],this.loading=!0,this.error="",this.newComment="",this.addingComment=!1,this.activeTab="details",this.shouldScrollToBottom=!1,this.isSignalRConnected=!1,this.baseUrl=et.baseUrl,this.showImagePreview=!1,this.selectedImagePath=null,this.staffList=[],this.selectedStaffId="",this.assigning=!1,this.loadingStaff=!1,this.statusDisplayMap={Open:"A\xE7\u0131k",Processing:"\u0130\u015Flemde",InProgress:"\u0130\u015Flemde",WaitingForCustomer:"M\xFC\u015Fteri Bekleniyor",Waiting:"M\xFC\u015Fteri Bekleniyor",Resolved:"\xC7\xF6z\xFCld\xFC",Closed:"Kapat\u0131ld\u0131",1:"A\xE7\u0131k",2:"\u0130\u015Flemde",3:"M\xFC\u015Fteri Bekleniyor",4:"\xC7\xF6z\xFCld\xFC",5:"Kapat\u0131ld\u0131"},this.priorityDisplayMap={Low:"D\xFC\u015F\xFCk",Medium:"Orta",High:"Y\xFCksek",Critical:"Kritik",1:"D\xFC\u015F\xFCk",2:"Orta",3:"Y\xFCksek",4:"Kritik"},this.priorityClassMap={Low:"low",Medium:"normal",High:"high",Critical:"critical",1:"low",2:"normal",3:"high",4:"critical"},this.statusStringToNumber={Open:1,Processing:2,WaitingForCustomer:3,Waiting:3,Resolved:4,Closed:5},this.priorityStringToNumber={Low:1,Medium:2,High:3,Critical:4},this.statusOptions=[],this.priorityOptions=[],this.isBrowser=q(V)}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");if(t){let a=this.systemParameterService.getByGroup("TicketStatus"),e=this.systemParameterService.getByGroup("TicketPriority");L([a,e]).subscribe({next:([r,s])=>{let C=r?.data?.data||r?.data||r||[],V=s?.data?.data||s?.data||s||[];this.statusOptions=(Array.isArray(C)?C:[]).map((b,I)=>({id:b.id,key:b.key,label:b.value,sortOrder:b.sortOrder??I+1,color:b.value2??b.color??null})),this.priorityOptions=(Array.isArray(V)?V:[]).map((b,I)=>({id:b.id,key:b.key,label:b.value,sortOrder:b.sortOrder??I+1,color:b.value2??b.color??null})),this.loadTicket(t),this.isBrowser&&this.initSignalR(t),this.loadStaff(),this.refreshInterval=setInterval(()=>{this.refreshCommentsAndHistory(t)},2e3)},error:()=>{this.loadTicket(t),this.isBrowser&&this.initSignalR(t),this.refreshInterval=setInterval(()=>{this.refreshCommentsAndHistory(t)},2e3),this.loadStaff()}})}}loadStaff(){this.loadingStaff=!0,this.staffService.getAllStaff(!0).subscribe({next:t=>{let a=t?.data?.$values||t?.data||t||[];this.staffList=Array.isArray(a)?a:[],this.loadingStaff=!1},error:()=>{this.loadingStaff=!1}})}ngOnDestroy(){this.refreshInterval&&clearInterval(this.refreshInterval);let t=this.route.snapshot.paramMap.get("id");t&&this.signalRService.leaveTicketGroup(t),this.commentSubscription?.unsubscribe()}openImagePreview(t){this.selectedImagePath=t,this.showImagePreview=!0}ngAfterViewChecked(){this.shouldScrollToBottom&&this.activeTab==="comments"&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}scrollToBottom(){try{this.commentsContainer&&(this.commentsContainer.nativeElement.scrollTop=this.commentsContainer.nativeElement.scrollHeight)}catch{}}scrollToCommentsBottom(){setTimeout(()=>this.scrollToBottom(),0)}loadTicket(t){this.loading=!0,this.ticketService.getTicketById(t).subscribe({next:a=>{let e=a?.data?.data||a?.data||a;if(typeof e.status=="string"){let s=this.statusOptions.find(C=>C.key===e.status||C.label===e.status);s?e.status=s.sortOrder??s.id??1:e.status=this.statusStringToNumber[e.status]||1}if(typeof e.priority=="string"){let s=this.priorityOptions.find(C=>C.key===e.priority||C.label===e.priority);s?e.priority=s.sortOrder??s.id??1:e.priority=this.priorityStringToNumber[e.priority]||1}this.ticket=e;let r=e.comments?.$values||e.comments||[];r=r.map(s=>s.isAdminReply&&s.authorName!=="Admin"?F(B({},s),{isStaff:!0}):s),this.comments=r,this.history=e.history?.$values||e.history||[],this.loading=!1,this.shouldScrollToBottom=!0},error:()=>{this.error="Talep y\xFCklenirken bir hata olu\u015Ftu",this.loading=!1}})}refreshCommentsAndHistory(t){this.ticketService.getTicketById(t).subscribe({next:a=>{let e=a?.data?.data||a?.data||a,r=e.comments?.$values||e.comments||[];r=r.map(s=>s.isAdminReply&&s.authorName!=="Admin"?F(B({},s),{isStaff:!0}):s),r.length!==this.comments.length&&(this.comments=r,this.shouldScrollToBottom=!0),this.history=e.history?.$values||e.history||[]}})}formatTicketId(t,a){if(a)return a;if(t==null)return"-";let e=typeof t=="number"?t:Number(t);return Number.isFinite(e)?`T${e.toString().padStart(5,"0")}`:String(t)}getStatusLabel(t){let a=Number(t),e=this.statusOptions.find(r=>Number(r.sortOrder??r.id)===a||String(r.id)===String(t)||String(r.key)===String(t)||r.label===t);return e?e.label||this.statusDisplayMap[t]||"Bilinmiyor":this.statusDisplayMap[t]??"Bilinmiyor"}getStatusClass(t){let a=Number(t),e=this.statusOptions.find(s=>Number(s.sortOrder??s.id)===a||String(s.id)===String(t)||String(s.key)===String(t)||s.label===t);if(e){let s=Number(e.sortOrder??e.id),C={1:"open",2:"processing",3:"waiting",4:"resolved",5:"closed",Open:"open",Processing:"processing",InProgress:"processing",WaitingForCustomer:"waiting",Waiting:"waiting",Resolved:"resolved",Closed:"closed"};return C[s]??C[e.key??e.label]??""}return{Open:"open",Processing:"processing",InProgress:"processing",WaitingForCustomer:"waiting",Waiting:"waiting",Resolved:"resolved",Closed:"closed",1:"open",2:"processing",3:"waiting",4:"resolved",5:"closed"}[t]??""}getPriorityLabel(t){let a=Number(t),e=this.priorityOptions.find(r=>Number(r.sortOrder??r.id)===a||String(r.id)===String(t)||String(r.key)===String(t)||r.label===t);return e?e.label||this.priorityDisplayMap[t]||"Normal":this.priorityDisplayMap[t]??"Normal"}getPriorityClass(t){let a=Number(t),e=this.priorityOptions.find(r=>Number(r.sortOrder??r.id)===a||String(r.id)===String(t)||String(r.key)===String(t)||r.label===t);if(e){let r=Number(e.sortOrder??e.id),s={1:"low",2:"normal",3:"high",4:"critical",Low:"low",Medium:"normal",High:"high",Critical:"critical"};return s[r]??s[e.key??e.label]??"normal"}return this.priorityClassMap[t]??"normal"}getStatusColor(t){let a=Number(t);return this.statusOptions.find(r=>Number(r.sortOrder??r.id)===a||String(r.id)===String(t)||String(r.key)===String(t)||r.label===t)?.color??null}getPriorityColor(t){let a=Number(t);return this.priorityOptions.find(r=>Number(r.sortOrder??r.id)===a||String(r.id)===String(t)||String(r.key)===String(t)||r.label===t)?.color??null}formatDate(t){return t?new Date(t).toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"}):"-"}formatFullDate(t){return t?new Date(t).toLocaleString("tr-TR"):"-"}goBack(){this.router.navigate(["/admin/tickets"])}goToEdit(){this.ticket&&this.router.navigate(["/admin/tickets",this.ticket.id,"edit"])}addComment(){!this.ticket||!this.newComment.trim()||(this.addingComment=!0,this.ticketService.addAdminComment(this.ticket.id,this.newComment.trim(),"Admin",!0).subscribe({next:()=>{this.newComment="",this.addingComment=!1,this.shouldScrollToBottom=!0;let t=this.ticket.id;this.ticketService.getTicketById(t).subscribe({next:a=>{let e=a?.data?.data||a?.data||a;this.history=e.history?.$values||e.history||[]}})},error:()=>{this.addingComment=!1}}))}initSignalR(t){return j(this,null,function*(){if(!this.isBrowser){console.log("SignalR: Not in browser environment");return}let a=localStorage.getItem("token")||sessionStorage.getItem("token");if(!a){console.warn("SignalR: No token found. User may not be authenticated."),this.error="Oturum s\xFCresi dolmu\u015F, l\xFCtfen sayfay\u0131 yenileyin";return}try{console.log("SignalR: Attempting to start connection with token"),yield this.signalRService.startConnection(a),console.log("SignalR: Joining ticket group",t),yield this.signalRService.joinTicketGroup(t),this.isSignalRConnected=!0,console.log("SignalR: Successfully connected and joined group"),this.commentSubscription=this.signalRService.commentReceived$.subscribe(e=>{console.log("Ticket-View: Received comment from SignalR:",e),String(e.ticketId)===String(t)&&(this.comments.some(s=>String(s.id)===String(e.id))?console.log("Ticket-View: Comment already exists, skipping"):(console.log("Ticket-View: Adding new comment to list"),this.comments=[...this.comments,e],this.shouldScrollToBottom=!0,this.ticketService.getTicketById(t).subscribe({next:s=>{let C=s?.data?.data||s?.data||s;this.history=C.history?.$values||C.history||[]}})))})}catch(e){console.error("SignalR: Connection failed:",e),this.isSignalRConnected=!1,console.warn("SignalR: Real-time updates disabled. Comments will appear after refresh.")}})}assignTicket(){if(!this.ticket||!this.selectedStaffId)return;let t=typeof this.selectedStaffId=="number"?this.selectedStaffId:Number(this.selectedStaffId),a=this.staffList.find(e=>Number(e.id)===t);a&&(this.assigning=!0,this.ticketService.assignTicket(this.ticket.id,a.fullName).subscribe({next:()=>{this.ticket&&(this.ticket.assignedPerson=a.fullName),this.assigning=!1,this.ticketService.getTicketById(this.ticket.id).subscribe({next:e=>{let r=e?.data?.data||e?.data||e;this.history=r.history?.$values||r.history||[]}})},error:()=>{this.assigning=!1}}))}static{this.\u0275fac=function(a){return new(a||n)(P(X),P(Z),P(mt),P(st),P(gt),P(dt),P(H))}}static{this.\u0275cmp=G({type:n,selectors:[["app-ticket-view"]],viewQuery:function(a,e){if(a&1&&U(_t,5),a&2){let r;K(r=Y())&&(e.commentsContainer=r.first)}},standalone:!0,features:[Q],decls:13,vars:4,consts:[["commentsContainer",""],[1,"ticket-view-page"],[1,"page-header"],[1,"header-left"],[1,"back-btn",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M19 12H5M12 19l-7-7 7-7"],[1,"ticket-info"],[1,"btn","btn-primary"],[1,"loading-container"],[1,"image-preview-overlay"],[1,"badge"],[1,"btn","btn-primary",3,"click"],["width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"],["d","M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"],[1,"loader"],[1,"error-container"],["width","48","height","48","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["cx","12","cy","12","r","10"],["d","M12 8v4M12 16h.01"],[1,"tabs"],[1,"tab",3,"click"],["d","M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"],["points","14 2 14 8 20 8"],["x1","16","y1","13","x2","8","y2","13"],["x1","16","y1","17","x2","8","y2","17"],["points","10 9 9 9 8 9"],["d","M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"],["points","12 6 12 12 16 14"],[1,"tab-content"],[1,"details-tab"],[1,"comments-tab"],[1,"history-tab"],[1,"main-content"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"form-group"],[1,"value"],[1,"value","description"],[1,"form-row"],[1,"sidebar"],[1,"current-assignee"],[1,"loading-staff"],[1,"btn","btn-primary","full-width",3,"click","disabled"],[1,"spinner-sm"],[1,"image-grid"],["type","button",1,"image-tile"],["type","button",1,"image-tile",3,"click"],["alt","Ticket Image",3,"src"],[1,"image-overlay"],[1,"image-container"],["type","button",1,"image-tile","single",3,"click"],[1,"assignee-info"],[1,"assignee-avatar"],[1,"no-staff"],[1,"form-control",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"comments-list"],[1,"empty-state"],[1,"add-comment"],["placeholder","Mesaj yaz\u0131n...","rows","3",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click","disabled"],[1,"comment",3,"admin","staff"],[1,"comment"],[1,"comment-header"],[1,"name"],[1,"admin-badge"],[1,"date"],[1,"comment-body"],[1,"timeline"],[1,"timeline-item"],[1,"timeline-dot"],[1,"timeline-content"],[1,"action"],[1,"meta"],[1,"by"],[1,"image-preview-overlay",3,"click"],[1,"preview-content",3,"click"],[1,"btn-close-preview",3,"click"],["alt","Buyuk Gorsel",3,"src"]],template:function(a,e){a&1&&(i(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),h("click",function(){return e.goBack()}),M(),i(4,"svg",5),f(5,"path",6),o(),l(6," Geri "),o(),p(7,ft,7,15,"div",7),o(),p(8,Ct,5,0,"button",8),o(),p(9,ut,4,0,"div",9)(10,xt,8,1)(11,Ht,24,11),o(),p(12,$t,5,1,"div",10)),a&2&&(c(7),g(7,e.ticket?7:-1),c(),g(8,e.ticket?8:-1),c(),g(9,e.loading?9:e.error?10:e.ticket?11:-1),c(3),g(12,e.showImagePreview?12:-1))},dependencies:[J,tt,ct,rt,lt,nt,at,it,ot],styles:['.ticket-view-page[_ngcontent-%COMP%]{padding:16px;max-width:1400px;margin:0 auto;overflow-x:hidden}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:12px;flex-wrap:wrap}.page-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.page-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 16px;background:#f1f5f9;border:none;border-radius:8px;color:#64748b;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.page-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]:hover{background:#e2e8f0;color:#334155}.page-header[_ngcontent-%COMP%]   .ticket-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;flex-wrap:wrap}.page-header[_ngcontent-%COMP%]   .ticket-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#1e293b;margin:0}.ticket-view-page[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:6px 12px;border-radius:999px;font-size:13px;font-weight:600;line-height:1;min-height:28px;white-space:nowrap}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.page-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]{flex-wrap:wrap}.page-header[_ngcontent-%COMP%]   .ticket-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:18px}.page-header[_ngcontent-%COMP%] > .btn-primary[_ngcontent-%COMP%]{width:100%;justify-content:center}}.status-badge[_ngcontent-%COMP%], .priority-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600}.status-badge.open[_ngcontent-%COMP%]{background:#dbeafe;color:#1d4ed8}.status-badge.processing[_ngcontent-%COMP%]{background:#fef3c7;color:#b45309}.status-badge.waiting[_ngcontent-%COMP%]{background:#e0e7ff;color:#4338ca}.status-badge.resolved[_ngcontent-%COMP%]{background:#d1fae5;color:#047857}.status-badge.closed[_ngcontent-%COMP%], .priority-badge.low[_ngcontent-%COMP%]{background:#f1f5f9;color:#64748b}.priority-badge.normal[_ngcontent-%COMP%]{background:#dbeafe;color:#1d4ed8}.priority-badge.high[_ngcontent-%COMP%]{background:#fed7aa;color:#c2410c}.priority-badge.critical[_ngcontent-%COMP%]{background:#fecaca;color:#b91c1c}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:80px 20px;text-align:center;color:#64748b}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px}.loader[_ngcontent-%COMP%]{width:48px;height:48px;border:4px solid #e2e8f0;border-top-color:#0ea5e9;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 20px;border:none;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#0284c7,#0369a1);transform:translateY(-1px)}.tabs[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:12px;border-bottom:1px solid #e2e8f0;padding-bottom:0}@media (max-width: 768px){.tabs[_ngcontent-%COMP%]{overflow-x:auto;-webkit-overflow-scrolling:touch;white-space:nowrap}}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 16px;background:none;border:none;border-bottom:2px solid transparent;color:#64748b;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;margin-bottom:-1px}@media (max-width: 768px){.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{flex:0 0 auto;padding:10px 12px;font-size:13px}}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]:hover{color:#334155}.tabs[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]{color:#0ea5e9;border-bottom-color:#0ea5e9}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#e2e8f0;color:#64748b;padding:6px 12px;border-radius:999px;font-size:13px;font-weight:600;line-height:1;min-height:28px}.tabs[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#dbeafe;color:#0ea5e9}.tab-content[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.details-tab[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 300px;gap:16px}.details-tab[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{min-width:0}@media (max-width: 1024px){.details-tab[_ngcontent-%COMP%]{grid-template-columns:1fr}}.details-tab[_ngcontent-%COMP%]   .main-content[_ngcontent-%COMP%], .details-tab[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 1px 3px #0000001a;overflow:hidden;min-width:0}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #e2e8f0}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:#1e293b;margin:0}.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:16px}.form-group[_ngcontent-%COMP%]{margin-bottom:12px}.form-group[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:12px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}.form-group[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:15px;color:#1e293b;margin:0;line-height:1.5}.form-group[_ngcontent-%COMP%]   .value.description[_ngcontent-%COMP%]{white-space:pre-wrap;background:#f8fafc;padding:12px 16px;border-radius:8px;border:1px solid #e2e8f0}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px}@media (max-width: 600px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.image-container[_ngcontent-%COMP%]   .image-tile.single[_ngcontent-%COMP%]{width:100%}.image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:400px;border-radius:8px;border:1px solid #e2e8f0;object-fit:contain}.image-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px}.image-grid[_ngcontent-%COMP%]   .image-tile[_ngcontent-%COMP%]{position:relative;width:100%;border:1px solid #e2e8f0;border-radius:8px;padding:0;background:#fff;overflow:hidden;cursor:zoom-in}.image-grid[_ngcontent-%COMP%]   .image-tile[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:120px;object-fit:cover;display:block}.image-grid[_ngcontent-%COMP%]   .image-tile[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0006;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .2s}.image-grid[_ngcontent-%COMP%]   .image-tile[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff;font-size:12px;font-weight:600;background:#0009;padding:6px 12px;border-radius:20px}.image-grid[_ngcontent-%COMP%]   .image-tile[_ngcontent-%COMP%]:hover   .image-overlay[_ngcontent-%COMP%]{opacity:1}.image-preview-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000e6;display:flex;align-items:center;justify-content:center;z-index:2000;padding:40px;cursor:zoom-out}.image-preview-overlay[_ngcontent-%COMP%]   .preview-content[_ngcontent-%COMP%]{position:relative;max-width:95%;max-height:95%;display:flex;align-items:center;justify-content:center;cursor:default}.image-preview-overlay[_ngcontent-%COMP%]   .preview-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:90vh;border-radius:8px;box-shadow:0 0 30px #00000080}.image-preview-overlay[_ngcontent-%COMP%]   .preview-content[_ngcontent-%COMP%]   .btn-close-preview[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;background:#ffffff1a;border:2px solid #fff;color:#fff;font-size:22px;width:40px;height:40px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center}.status-display[_ngcontent-%COMP%]{padding:12px 16px;border-radius:8px;font-size:15px;font-weight:600;text-align:center}.status-display.open[_ngcontent-%COMP%]{background:#dbeafe;color:#1d4ed8}.status-display.processing[_ngcontent-%COMP%]{background:#fef3c7;color:#b45309}.status-display.waiting[_ngcontent-%COMP%]{background:#e0e7ff;color:#4338ca}.status-display.resolved[_ngcontent-%COMP%]{background:#d1fae5;color:#047857}.status-display.closed[_ngcontent-%COMP%]{background:#f1f5f9;color:#64748b}.priority-display[_ngcontent-%COMP%]{padding:12px 16px;border-radius:8px;font-size:15px;font-weight:600;text-align:center}.priority-display.low[_ngcontent-%COMP%]{background:#f1f5f9;color:#64748b}.priority-display.normal[_ngcontent-%COMP%]{background:#dbeafe;color:#1d4ed8}.priority-display.high[_ngcontent-%COMP%]{background:#fed7aa;color:#c2410c}.priority-display.critical[_ngcontent-%COMP%]{background:#fecaca;color:#b91c1c}.assignee-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.assignee-info[_ngcontent-%COMP%]   .assignee-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#fff;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:600}.assignee-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:15px;font-weight:500;color:#1e293b}.no-assignee[_ngcontent-%COMP%]{color:#94a3b8;font-size:14px;margin:0;text-align:center;padding:8px}.comments-tab[_ngcontent-%COMP%]{max-width:800px}@media (max-width: 768px){.comments-tab[_ngcontent-%COMP%]{max-width:100%}}.comments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;max-height:350px;overflow-y:auto}.comment[_ngcontent-%COMP%]{padding:12px;background:#f8fafc;border-radius:12px;border-left:3px solid #e2e8f0;display:flex;flex-direction:column;align-self:flex-start;max-width:70%}@media (max-width: 768px){.comment[_ngcontent-%COMP%]{max-width:100%}}.comment.admin[_ngcontent-%COMP%]{background:#f0f9ff;border-left-color:#0ea5e9;align-self:flex-end}.comment.staff[_ngcontent-%COMP%]{background:#f8fafc;border-left-color:#e2e8f0;align-self:flex-start}.comment[_ngcontent-%COMP%]   .comment-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:12px}.comment[_ngcontent-%COMP%]   .comment-header[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:600;color:#1e293b}.comment[_ngcontent-%COMP%]   .comment-header[_ngcontent-%COMP%]   .admin-badge[_ngcontent-%COMP%]{font-size:11px;padding:2px 8px;background:#0ea5e9;color:#fff;border-radius:10px}.comment[_ngcontent-%COMP%]   .comment-header[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:12px;color:#94a3b8;margin-left:auto}.comment[_ngcontent-%COMP%]   .comment-body[_ngcontent-%COMP%]{color:#334155;line-height:1.6;white-space:pre-wrap}.add-comment[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-top:16px;padding-top:16px;border-top:1px solid #e2e8f0}.add-comment[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{align-self:flex-end}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;color:#94a3b8}.empty-state[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:.5}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:12px;font-size:14px}.history-tab[_ngcontent-%COMP%]{max-width:800px}@media (max-width: 768px){.history-tab[_ngcontent-%COMP%]{max-width:100%}}.timeline[_ngcontent-%COMP%]{position:relative;padding-left:24px;max-height:350px;overflow-y:auto}.timeline[_ngcontent-%COMP%]:before{content:"";position:absolute;left:7px;top:0;bottom:0;width:2px;background:#e2e8f0}.timeline[_ngcontent-%COMP%]   .timeline-item[_ngcontent-%COMP%]{position:relative;padding-bottom:16px}.timeline[_ngcontent-%COMP%]   .timeline-item[_ngcontent-%COMP%]:last-child{padding-bottom:0}.timeline[_ngcontent-%COMP%]   .timeline-item[_ngcontent-%COMP%]   .timeline-dot[_ngcontent-%COMP%]{position:absolute;left:-20px;top:4px;width:12px;height:12px;border-radius:50%;background:#fff;border:3px solid #0ea5e9}.timeline[_ngcontent-%COMP%]   .timeline-item[_ngcontent-%COMP%]   .timeline-content[_ngcontent-%COMP%]{background:#f8fafc;padding:12px 16px;border-radius:8px}.timeline[_ngcontent-%COMP%]   .timeline-item[_ngcontent-%COMP%]   .timeline-content[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{font-size:14px;color:#1e293b;margin:0 0 8px}.timeline[_ngcontent-%COMP%]   .timeline-item[_ngcontent-%COMP%]   .timeline-content[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{display:flex;gap:12px;font-size:12px;color:#94a3b8}.timeline[_ngcontent-%COMP%]   .timeline-item[_ngcontent-%COMP%]   .timeline-content[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]   .by[_ngcontent-%COMP%]{font-weight:500;color:#64748b}@media (max-width: 768px){.ticket-view-page[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:12px}.form-group[_ngcontent-%COMP%]   .value.description[_ngcontent-%COMP%]{padding:10px 12px}.assignee-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{word-break:break-word}}@media (max-width: 480px){.ticket-view-page[_ngcontent-%COMP%]{padding:10px;max-width:100%}.status-badge[_ngcontent-%COMP%], .priority-badge[_ngcontent-%COMP%]{font-size:11px;padding:3px 10px}.page-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]{width:100%;gap:10px}.page-header[_ngcontent-%COMP%]   .ticket-info[_ngcontent-%COMP%]{width:100%;gap:8px}.page-header[_ngcontent-%COMP%]   .ticket-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:16px;width:100%;overflow-wrap:anywhere}.details-tab[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:12px}.details-tab[_ngcontent-%COMP%]   .main-content[_ngcontent-%COMP%], .details-tab[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{width:100%;min-width:0}.card[_ngcontent-%COMP%]{width:100%}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:10px}.tabs[_ngcontent-%COMP%]{white-space:normal;overflow:visible;flex-wrap:wrap;gap:6px}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{flex:1 1 calc(50% - 6px);justify-content:center;min-height:40px}.tab-content[_ngcontent-%COMP%]{min-width:0}.form-group[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   .value.description[_ngcontent-%COMP%], .assignee-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{overflow-wrap:anywhere;word-break:break-word}.image-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.image-preview-overlay[_ngcontent-%COMP%]{padding:16px}}']})}}return n})();export{le as TicketViewComponent};
